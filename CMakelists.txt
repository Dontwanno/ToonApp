cmake_minimum_required(VERSION 3.24)

set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

# --- VCPKG SETUP ---
set(VCPKG_PATH "/Users/twan.grooff/vcpkg/scripts/buildsystems/vcpkg.cmake") 
if(EXISTS "${VCPKG_PATH}")
    set(CMAKE_TOOLCHAIN_FILE "${VCPKG_PATH}")
    set(VCPKG_TARGET_TRIPLET "arm64-osx")
endif()

project(ToonGame VERSION 1.0.0 LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

if(APPLE)
    set(CMAKE_OSX_ARCHITECTURES "arm64")
endif()

# --- Find Packages ---
find_package(glfw3 CONFIG REQUIRED)
find_package(glm CONFIG REQUIRED)
find_package(assimp CONFIG REQUIRED)
find_package(glad CONFIG REQUIRED)
find_package(Stb REQUIRED)
find_package(imgui CONFIG REQUIRED)
find_package(urdfdom CONFIG REQUIRED)
find_package(mujoco CONFIG REQUIRED)

# --- AUTOMATIC SOURCE COLLECTION ---
# Finds any .cpp in src/ or subfolders (e.g. src/Entities/Player.cpp)
file(GLOB_RECURSE PROJECT_SOURCES CONFIGURE_DEPENDS "src/*.cpp")

# Finds headers (mostly so they show up in your VS Code file tree correctly)
file(GLOB_RECURSE PROJECT_HEADERS CONFIGURE_DEPENDS "include/*.h")

# Create Executable
add_executable(${PROJECT_NAME} ${PROJECT_SOURCES} ${PROJECT_HEADERS})

configure_file(
    "${CMAKE_SOURCE_DIR}/root_directory.h.in"        # 1. Read the template
    "${CMAKE_BINARY_DIR}/include/root_directory.h"    # 2. Generate the real file here
)

# --- INCLUDE PATHS ---
# Allows you to include headers from 'include/' folder easily
target_include_directories(${PROJECT_NAME} PRIVATE 
    include 
    "${CMAKE_BINARY_DIR}/include"
    ${Stb_INCLUDE_DIR} # Manually include Stb headers
)

# --- LINKING ---
target_link_libraries(${PROJECT_NAME} PRIVATE
    glfw
    glm::glm
    assimp::assimp
    glad::glad
    imgui::imgui

    urdfdom::urdf_parser     
    urdfdom::urdfdom_model
    urdfdom::urdfdom_world

    mujoco::mujoco
)

if(APPLE)
    target_link_libraries(${PROJECT_NAME} PRIVATE
        "-framework Cocoa"
        "-framework IOKit"
        "-framework CoreVideo"
    )
endif()

# --- ASSET COPYING ---
# Automatically copies the 'assets' folder to the build folder
add_custom_command(TARGET ${PROJECT_NAME} POST_BUILD
    COMMAND ${CMAKE_COMMAND} -E copy_directory
    "${CMAKE_SOURCE_DIR}/assets"
    "$<TARGET_FILE_DIR:${PROJECT_NAME}>/assets"
    COMMENT "Copying assets to build output..."
)
